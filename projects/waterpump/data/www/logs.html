<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Pump Logs</title>
    <link rel="stylesheet" type="text/css" href="main.css" />
</head>

<body>
    <div class="content">
        <h1>Pump Logs</h1>
        <hr />
        <div>
            <form action="/"><button type="submit">Home</button></form>
            <form id="reload-form" action="/j/get_logs" , method="GET">
                <button type="button" id="reload" onclick="javascript:loadData();">Reload</button>
            </form>
            <form action="/j/clear_logs" method="POST">
                <button id="clear" type="submit">Clear</button>
            </form>
        </div>
        <hr />
        <div class="output" id="output"></div>
    </div>
    <script>
        function loadData() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/j/get_logs');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var outputText = xhr.responseText.split(/\n/).map((it) => "<p>" + it + "</p>").join("\n");
                    document.getElementById("output").innerHTML = outputText;
                } else {
                    console.error("Failed: " + xhr.statusText);
                    document.getElementById("output").innerHTML = "<p>Error: " + xhr.statusText + "</p>";
                }
            };
            xhr.send();
            return false;
        }
        window.addEventListener('DOMContentLoaded', (e) => {
            // call on dom loaded.
            loadData();
            var btnClear = document.getElementById('clear');
            btnClear.onclick = function (e) {
                var cf = confirm("Are you sure to delete all logs?");
                if (cf) {
                    e.preventDefault();
                    xhr = new XMLHttpRequest();
                    xhr.onload = function () {
                        if (xhr.status < 400) {
                            alert('Server logs is cleared!');
                            console.log("Clear logs ok.");
                        }
                        loadData();
                    };
                    xhr.open("POST", "/j/clear_logs");
                    xhr.send();
                    return true;
                }
                return false;
            };
        });
    </script>
</body>

</html>